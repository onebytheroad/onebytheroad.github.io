---
title: 12-06 汇编编写
description: 我不再爱她，这是确定的，但也许我爱她。爱情太短，而遗忘太长
date: 2025-12-06
slug: 12-06
image: bj.jpg
categories:
  - 汇编语言 
---

函数的ABI规范

\- 参数通过 `rdi, rsi, rdx...` 传递
\- 返回值在 `rax`
\- `rbx, rbp, r12–r15` 是 callee-saved，其余是 caller-saved

寄存器的分类

| **参数/返回**            | `rdi`, `rsi`, `rdx`, `rcx`, `r8`, `r9`, `rax` | 传参 + 返回值                  |
| ------------------------ | --------------------------------------------- | ------------------------------ |
| **callee-saved**         | `rbx`, `rbp`, `r12–r15`                       | 可安全用于保存中间值           |
| **临时（caller-saved）** | `r10`, `r11`                                  | 自由使用，调用函数后可能被破坏 |

使用地址中的参数，注意要求导入的数据长度

多个参数的传递：

| 参数序号 | 寄存器（64位） | 32位形式 | 用途说明                    |
| -------- | -------------- | -------- | --------------------------- |
| 第1个    | `rdi`          | `edi`    | 常用于目标地址（如 `dest`） |
| 第2个    | `rsi`          | `esi`    | 常用于源地址（如 `src`）    |
| 第3个    | `rdx`          | `edx`    | 数据、长度等                |
| 第4个    | `rcx`          | `ecx`    | 计数、标志等                |
| 第5个    | `r8`           | `r8d`    | —                           |
| 第6个    | `r9`           | `r9d`    | —                           |

超过6个则需要使用栈传递（注意保持16字节对齐）

浮点数用XMM寄存器



函数中用栈使用数组时，需要对其清零

```
mov rcx, 0
clear_loop:
    mov word ptr [rsp + rcx*2], 0
    inc rcx
    cmp rcx, 256
    jl clear_loop
循环清零计数器，处理完rsp设定字节
```



